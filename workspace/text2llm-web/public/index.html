<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>Text2LLM â€” AI Virtual Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Orbitron:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="/applogo.jpeg" />
    <link rel="stylesheet" href="/styles.css" />
    <!-- xterm.js CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Cloudflare Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  </head>
  <body>
    <div class="app-layout">

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="header-row" style="display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 24px;">
            <div class="logo-area" style="margin-bottom: 0;">
              <img src="/applogo.jpeg" class="app-logo" alt="Text2LLM" />
            </div>
            <button id="sidebar-close-btn" class="icon-btn" aria-label="Toggle sidebar">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                <line x1="9" y1="3" x2="9" y2="21" />
              </svg>
            </button>
          </div>

          <button class="new-chat-btn new-project-btn" id="new-chat-btn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 20h9" />
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
            </svg>
            <span>New project</span>
          </button>
        </div>

        <nav class="sidebar-nav">
          <!-- ... existing nav content ... -->
          <div class="nav-section">
            <div class="nav-label" id="current-project-name">No project selected</div>
            <a href="#" class="nav-item active" data-view="home">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
              </svg>
              <span>Mission Control</span>
            </a>
            <!-- ... -->

            <a href="#" class="nav-item" data-view="clui">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                <line x1="8" y1="21" x2="16" y2="21" />
                <line x1="12" y1="17" x2="12" y2="21" />
              </svg>
              <span>Runtime</span>
            </a>
            <a href="#" class="nav-item" data-view="notebook">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                <path
                  d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
                />
              </svg>
              <span>Experiments</span>
            </a>
            <a href="#" class="nav-item" data-view="dataset-creator" title="Open Dataset Creator">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <ellipse cx="12" cy="5" rx="8" ry="3" />
                <path d="M4 5v10c0 1.66 3.58 3 8 3s8-1.34 8-3V5" />
                <path d="M4 10c0 1.66 3.58 3 8 3s8-1.34 8-3" />
              </svg>
              <span>Dataset Creator</span>
            </a>
            <a href="#" class="nav-item" data-view="data-studio" title="Open Data Studio">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="16" rx="2" ry="2" />
                <line x1="3" y1="10" x2="21" y2="10" />
                <line x1="9" y1="10" x2="9" y2="20" />
              </svg>
              <span>Data Studio</span>
            </a>
          </div>

          <div class="nav-section bottom-section">
            <div class="nav-label">Operations</div>
            <a href="#" class="nav-item" data-view="projects">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
              </svg>
              <span>Project Vault</span>
            </a>
            <a href="#" class="nav-item" data-view="instances">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="2" y="2" width="20" height="8" rx="2" ry="2" />
                <rect x="2" y="14" width="20" height="8" rx="2" ry="2" />
                <line x1="6" y1="6" x2="6.01" y2="6" />
                <line x1="6" y1="18" x2="6.01" y2="18" />
              </svg>
              <span>Infrastructure</span>
            </a>
            <a href="#" class="nav-item" data-view="store">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                <line x1="3" y1="6" x2="21" y2="6" />
                <path d="M16 10a4 4 0 0 1-8 0" />
              </svg>
              <span>Model Library</span>
            </a>
            <a href="#" class="nav-item" data-view="settings">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="1" y1="14" x2="7" y2="14"></line>
                <line x1="9" y1="8" x2="15" y2="8"></line>
                <line x1="17" y1="16" x2="23" y2="16"></line>
              </svg>
              <span>Settings</span>
            </a>
          </div>

          <div class="user-profile" id="sidebar-user-profile" style="cursor: pointer;" title="Sign In / Account">
            <div class="avatar">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
            </div>
            <div class="user-info">
              <span class="user-name">User</span>
              <span class="user-plan">Builder</span>
            </div>
            <button id="theme-toggle" class="icon-btn" style="margin-left: auto;" aria-label="Toggle theme">
               <!-- Default Moon (Dark Mode) -->
               <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                 <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
               </svg>
               <!-- Sun (Light Mode) - Hidden by default -->
               <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                  <circle cx="12" cy="12" r="5"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
               </svg>
            </button>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Desktop Sidebar Toggle & Title (Visible when sidebar is closed) -->
        <div class="desktop-header-controls" style="position: absolute; top: 20px; left: 20px; display: none; align-items: center; gap: 12px; z-index: 50;">
          <button id="sidebar-open-btn" class="icon-btn" aria-label="Open sidebar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <line x1="9" y1="3" x2="9" y2="21" />
            </svg>
          </button>
          <span class="app-title-main" style="font-weight: 600; font-size: 1.1rem; color: var(--text);">text2llm</span>
        </div>

        <!-- Mobile Header -->
        <header class="mobile-header">
          <button class="menu-toggle" id="menu-toggle">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="12" x2="21" y2="12" />
              <line x1="3" y1="6" x2="21" y2="6" />
              <line x1="3" y1="18" x2="21" y2="18" />
            </svg>
          </button>
          <span class="mobile-logo-text">text2llm</span>
        </header>

        <!-- HOME VIEW -->
        <div id="home-view" class="view active">
          <div class="home-chat-layout">
            <button
              type="button"
              id="chat-list-toggle-btn"
              class="chat-list-toggle-btn"
              title="Open chats"
              aria-label="Open chats"
              aria-expanded="false"
            >
              Chats
            </button>
            <aside class="chat-list-pane" aria-label="Chat Threads">
              <div class="chat-list-header">
                <div class="chat-list-header-row">
                  <div class="chat-list-title">Project Sessions</div>
                  <button type="button" class="chat-list-close-btn" id="chat-list-close-btn" title="Close chats" aria-label="Close chats">Ã—</button>
                </div>
                <button type="button" class="chat-thread-new-btn" id="home-new-chat-btn">+ New Chat</button>
              </div>
              <div class="chat-thread-list" id="chat-thread-list"></div>
            </aside>

            <section class="chat-main-pane">
              <!-- Welcome Section (hidden when chatting) -->
              <div id="welcome-section" class="welcome-container">
                <div class="lab-hero-meta">Active Project Workspace</div>
                <h1 class="welcome-title">Virtual AI Lab</h1>
                <p class="welcome-subtitle">Choose a recommendation or send your next project instruction.</p>

                <div class="suggestion-chips">
                  <button class="suggestion-chip">Define a domain-specific project objective and constraints</button>
                  <button class="suggestion-chip">Prepare a data quality checklist for finetuning</button>
                  <button class="suggestion-chip">Design evaluation gates before deployment</button>
                </div>
              </div>

              <!-- Chat Messages Area -->
              <div id="chat-messages" class="chat-messages"></div>

              <!-- Chat Input -->
                                          <form id="idea-form" class="chat-input-area gemini-style">
                <textarea id="idea-input" placeholder="Ask anything about your project..." rows="1"></textarea>
                
                <div class="chat-input-toolbar">
                  <div class="chat-input-tools-left">
                    <button type="button" class="action-btn add-btn" title="Attach file">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                      </svg>
                    </button>
                  </div>

                  <div class="chat-input-tools-right">
                    <!-- Model Selector -->
                    <div class="model-selector-wrapper" id="model-selector-wrapper">
                      <button type="button" class="model-selector-btn" id="model-selector-btn" title="Select model">
                        <span class="model-selector-icon" id="model-selector-icon">✦</span>
                        <span class="model-selector-label" id="model-selector-label">Model</span>
                        <span class="model-selector-chevron">▾</span>
                      </button>
                      <div class="model-selector-dropdown" id="model-selector-dropdown">
                        <div class="model-selector-loading">Loading providers…</div>
                      </div>
                    </div>

                    <button type="submit" class="action-btn submit-btn" id="send-btn" title="Send message">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="19" x2="12" y2="5" />
                        <polyline points="5 12 12 5 19 12" />
                      </svg>
                    </button>
                    <button type="button" class="action-btn stop-btn" id="stop-btn" title="Stop generating" style="display:none;">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="6" width="12" height="12" rx="2" />
                      </svg>
                    </button>
                  </div>
                </div>
              </form>
            </section>
          </div>
        </div>
        <!-- /HOME VIEW -->

        <!-- INSTANCES VIEW -->
        <div id="instances-view" class="view">
          <div class="instances-container">
            <div class="instances-header">
              <h2 class="instances-title">Instances</h2>
              <p class="instances-subtitle">Configure your AI backend, GPU resources, and storage</p>
            </div>

            <!-- Tab Bar -->
            <div class="instances-tabs">
              <button class="instance-tab active" data-tab="ai">AI</button>
              <button class="instance-tab" data-tab="gpu">GPU</button>
              <button class="instance-tab" data-tab="storage">Storage</button>
            </div>

            <!-- AI Tab Content -->
            <div class="instance-tab-content active" id="tab-ai">
              <p class="tab-description">Select the AI provider that powers your Text2LLM agent backend.</p>
              <div class="provider-grid" id="provider-grid">
                <!-- Provider cards will be injected by JS -->
              </div>
            </div>

            <!-- GPU Tab Content -->
            <div class="instance-tab-content" id="tab-gpu">
              <!-- Readiness Banner -->
              <div class="gpu-readiness-banner" id="gpu-readiness-banner">
                <div class="gpu-readiness-dot"></div>
                <span id="gpu-readiness-state">Not connected</span>
              </div>
              <p id="gpu-credentials-status" class="gpu-inline-status" style="display:none;"></p>

              <!-- Provider Cards Grid -->
              <div class="gpu-providers-section">
                <div class="gpu-section-header">
                  <h3>Connect a GPU Provider</h3>
                  <p>Choose where to run your GPU workloads</p>
                </div>
                <div class="gpu-provider-grid-v2" id="gpu-provider-grid">
                  <!-- GPU Provider cards injected by JS -->
                </div>
              </div>

              <!-- Active Instances -->
              <div class="gpu-instances-section">
                <div class="gpu-section-header">
                  <h3>Your Instances</h3>
                  <button id="gpu-launch-open-btn" class="gpu-launch-trigger" type="button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    New Instance
                  </button>
                </div>
                <div id="gpu-instance-list" class="gpu-instance-grid"></div>
              </div>

              <!-- Launch Instance Drawer (hidden by default) -->
              <div id="gpu-launch-drawer" class="gpu-launch-drawer hidden">
                <div class="gpu-launch-drawer-inner">
                  <div class="gpu-launch-drawer-header">
                    <h3>Launch New Instance</h3>
                    <button id="gpu-launch-close-btn" class="gpu-drawer-close" type="button">&times;</button>
                  </div>
                  <div class="gpu-launch-form">
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Region</span>
                        <select id="gpu-region-select" class="gpu-form-select"></select>
                      </label>
                      <label class="gpu-form-label">
                        <span>GPU Type</span>
                        <select id="gpu-type-select" class="gpu-form-select"></select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Count</span>
                        <input id="gpu-count-input" class="gpu-form-input" type="number" min="1" value="1" />
                      </label>
                    </div>
                    <label class="gpu-form-label">
                      <span>Instance Name</span>
                      <input id="gpu-name-input" class="gpu-form-input" type="text" placeholder="e.g. prod-inference-a100" />
                    </label>
                    <div class="gpu-launch-actions">
                      <button id="gpu-launch-btn" class="gpu-launch-btn-primary" type="button">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        Launch Instance
                      </button>
                      <p id="gpu-launch-status" class="gpu-inline-status"></p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Inference Playground -->
              <div class="gpu-inference-section">
                <div class="gpu-section-header">
                  <h3>Inference Playground</h3>
                  <p>Test your running instances with a quick prompt</p>
                </div>
                <div class="gpu-inference-card">
                  <div class="gpu-inference-top">
                    <label class="gpu-form-label gpu-infer-target">
                      <span>Target Instance</span>
                      <select id="gpu-infer-instance-select" class="gpu-form-select"></select>
                    </label>
                  </div>
                  <div class="gpu-inference-input-area">
                    <textarea id="gpu-infer-prompt" class="gpu-inference-textarea" rows="3" placeholder="Write a short response about your AI task..."></textarea>
                    <button id="gpu-infer-btn" class="gpu-inference-run-btn" type="button">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    </button>
                  </div>
                  <p id="gpu-infer-status" class="gpu-inline-status"></p>
                  <pre id="gpu-infer-output" class="gpu-infer-output"></pre>
                </div>
              </div>
            </div>

            <!-- Storage Tab Content -->
            <div class="instance-tab-content" id="tab-storage">
              <!-- Status banner (mirrors GPU readiness banner) -->
              <div class="gpu-readiness-banner" id="storage-readiness-banner">
                <div class="gpu-readiness-dot"></div>
                <span id="storage-readiness-state">No providers connected</span>
              </div>
              <p id="storage-status" class="gpu-inline-status"></p>

              <!-- Provider Cards Grid -->
              <div class="gpu-providers-section">
                <div class="gpu-section-header">
                  <h3>Connect a Storage Provider</h3>
                  <p>Choose where artifacts are stored. OAuth providers keep user-owned tokens per session.</p>
                </div>
                <div class="gpu-provider-grid-v2" id="storage-provider-grid">
                  <!-- Storage provider cards injected by JS -->
                </div>
              </div>

              <!-- Container Usage (read-only cards, like GPU instances) -->
              <div class="gpu-instances-section">
                <div class="gpu-section-header">
                  <h3>Lifecycle Containers</h3>
                  <p>Data, tokenizer, checkpoints, evals, and model exports</p>
                </div>
                <div id="storage-container-grid" class="storage-container-grid"></div>
              </div>

              <!-- Project & Sync Settings Drawer (hidden by default, like GPU launch drawer) -->
              <div id="storage-settings-drawer" class="gpu-launch-drawer hidden">
                <div class="gpu-launch-drawer-inner">
                  <div class="gpu-launch-drawer-header">
                    <h3 class="storage-settings-title">Storage Settings</h3>
                    <button id="storage-settings-close-btn" class="gpu-drawer-close" type="button">&times;</button>
                  </div>

                  <div class="menu-hero-card menu-hero-card-compact storage-settings-hero">
                    <div class="menu-hero-shapes" aria-hidden="true">
                      <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                        <path d="M 120 0 Q 80 100 200 120 L 200 0 Z" fill="#2eb0f1" />
                        <path d="M 200 100 Q 150 150 200 200 Z" fill="#24b662" />
                        <path d="M 100 200 Q 150 100 200 150 L 200 200 Z" fill="#fcca22" />
                      </svg>
                    </div>
                    <div class="menu-hero-content">
                      <p class="menu-hero-eyebrow">Storage</p>
                      <h4>Project & Sync Controls</h4>
                      <p>Manage retention, replication, and restore policies in one place.</p>
                    </div>
                  </div>

                  <div class="storage-settings-tabs">
                    <button class="storage-settings-tab active" data-stab="project">Project</button>
                    <button class="storage-settings-tab" data-stab="sync">Sync & Retention</button>
                    <button class="storage-settings-tab" data-stab="replication">Replication</button>
                    <button class="storage-settings-tab" data-stab="history">History</button>
                  </div>

                  <div class="storage-settings-panel active" id="storage-panel-project">
                    <div class="gpu-launch-form">
                      <div class="gpu-form-row">
                        <label class="gpu-form-label">
                          <span>Project Name</span>
                          <input id="storage-project-name" class="gpu-form-input" type="text" placeholder="medical-llm-1b" />
                        </label>
                        <label class="gpu-form-label">
                          <span>Default Provider</span>
                          <select id="storage-default-provider" class="gpu-form-select"></select>
                        </label>
                        <label class="gpu-form-label">
                          <span>Root Path</span>
                          <input id="storage-root-path" class="gpu-form-input" type="text" placeholder="Text2LLM/medical-llm-1b" />
                        </label>
                      </div>
                      <div class="gpu-launch-actions">
                        <button id="storage-save-project-btn" class="gpu-launch-btn-primary" type="button">Save Mapping</button>
                      </div>
                    </div>
                  </div>

                  <div class="storage-settings-panel" id="storage-panel-sync">
                    <div class="gpu-launch-form">
                      <div class="gpu-form-row">
                        <label class="gpu-form-label">
                          <span>Sync Mode</span>
                          <select id="storage-sync-mode" class="gpu-form-select">
                            <option value="manual">Manual</option>
                            <option value="steps">Every N steps</option>
                            <option value="minutes">Every N minutes</option>
                          </select>
                        </label>
                        <label class="gpu-form-label">
                          <span>Keep Last N</span>
                          <input id="storage-retention-keep" class="gpu-form-input" type="number" min="1" value="5" />
                        </label>
                      </div>
                      <div class="gpu-form-row">
                        <label class="gpu-form-label">
                          <span>Every N Steps</span>
                          <input id="storage-sync-steps" class="gpu-form-input" type="number" min="1" value="500" />
                        </label>
                        <label class="gpu-form-label">
                          <span>Every N Minutes</span>
                          <input id="storage-sync-minutes" class="gpu-form-input" type="number" min="1" value="15" />
                        </label>
                      </div>
                      <div class="gpu-launch-actions">
                        <button id="storage-save-policy-btn" class="gpu-launch-btn-primary" type="button">Save Policy</button>
                        <button id="storage-sync-now-btn" class="gpu-launch-btn" type="button">Sync Now</button>
                      </div>
                    </div>
                  </div>

                  <div class="storage-settings-panel" id="storage-panel-replication">
                    <div class="gpu-launch-form">
                      <div class="gpu-form-row">
                        <label class="gpu-form-label">
                          <span>Primary Provider</span>
                          <select id="storage-primary-provider" class="gpu-form-select"></select>
                        </label>
                        <label class="gpu-form-label">
                          <span>Backup Provider</span>
                          <select id="storage-backup-provider" class="gpu-form-select"></select>
                        </label>
                        <label class="gpu-form-label">
                          <span>Replication</span>
                          <select id="storage-replication-enabled" class="gpu-form-select">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                          </select>
                        </label>
                      </div>
                      <div class="gpu-launch-actions">
                        <button id="storage-save-replication-btn" class="gpu-launch-btn-primary" type="button">Save Replication</button>
                        <button id="storage-restore-latest-btn" class="gpu-launch-btn" type="button">Restore</button>
                      </div>
                    </div>
                  </div>

                  <div class="storage-settings-panel" id="storage-panel-history">
                    <div class="storage-history-section">
                      <h4 style="margin:0 0 8px;font-size:0.85rem;color:var(--text-secondary);">Sync Jobs</h4>
                      <div id="storage-sync-history" class="storage-history-list">
                        <div class="provider-loading">No sync jobs yet.</div>
                      </div>
                      <h4 style="margin:16px 0 8px;font-size:0.85rem;color:var(--text-secondary);">Restore Jobs</h4>
                      <div id="storage-restore-history" class="storage-history-list">
                        <div class="provider-loading">No restore jobs yet.</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Summary Bar (compact stats, like GPU inference section) -->
              <div class="gpu-inference-section">
                <div class="gpu-section-header">
                  <h3>Storage Overview</h3>
                  <div style="display:flex;gap:8px;align-items:center;">
                    <button id="storage-settings-open-btn" class="gpu-launch-trigger" type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                      Settings
                    </button>
                    <button id="storage-refresh-btn" class="gpu-launch-trigger" type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.13-3.36L23 10M1 14l5.36 4.36A9 9 0 0 0 20.49 15"/></svg>
                      Refresh
                    </button>
                  </div>
                </div>
                <div id="storage-cost-summary" class="storage-overview-bar"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- /INSTANCES VIEW -->

        <!-- CLUI VIEW -->
        <div id="clui-view" class="view">
          <div class="terminal-container">
            <div class="runtime-toolbar">
              <label class="runtime-toolbar-label" for="runtime-filter-select">View</label>
              <select id="runtime-filter-select" class="runtime-toolbar-select">
                <option value="all" selected>All</option>
                <option value="commands">Commands only</option>
                <option value="errors">Errors only</option>
                <option value="verbose">Verbose</option>
              </select>
              <label class="runtime-toolbar-label" for="runtime-replay-tail">Replay</label>
              <select id="runtime-replay-tail" class="runtime-toolbar-select">
                <option value="100">Last 100</option>
                <option value="200" selected>Last 200</option>
                <option value="500">Last 500</option>
                <option value="1000">Last 1000</option>
              </select>
              <button id="runtime-replay-btn" class="runtime-toolbar-btn" type="button">Replay Now</button>
            </div>
            <div id="terminal"></div>
          </div>
        </div>
        <!-- /CLUI VIEW -->

        <!-- NOTEBOOK VIEW -->
        <div id="notebook-view" class="view">
          <div class="nb-container">
            <div class="nb-header">
              <div class="nb-header-left">
                <h2 class="nb-title">Notebook</h2>
                <span class="nb-subtitle">Python cells managed by text2llm</span>
              </div>
              <div class="nb-toolbar">
                <button id="nb-run-all-btn" class="nb-toolbar-btn" type="button" title="Run all cells">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                  Run All
                </button>
                <button id="nb-clear-btn" class="nb-toolbar-btn" type="button" title="Clear all outputs">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg>
                  Clear
                </button>
                <button id="nb-add-code-btn" class="nb-toolbar-btn nb-toolbar-primary" type="button" title="Add code cell">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Code
                </button>
                <button id="nb-add-md-btn" class="nb-toolbar-btn" type="button" title="Add markdown cell">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Markdown
                </button>
                <button id="nb-templates-btn" class="nb-toolbar-btn nb-toolbar-templates" type="button" title="Insert from templates">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                  Templates
                </button>
              </div>
            </div>
            <div id="nb-cells" class="nb-cells">
              <!-- Cells rendered by JS -->
            </div>
            <p id="nb-status" class="nb-status-msg"></p>
          </div>
        </div>

        <!-- Replace/Continue Confirmation Modal -->
        <div id="nb-tpl-confirm-modal" class="nb-tpl-overlay" style="display:none; z-index: 1001;">
          <div class="nb-tpl-modal" style="max-width: 400px; padding: 20px;">
            <h3 style="margin-top: 0; margin-bottom: 12px; color: var(--text);">Insert Template</h3>
            <p style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 24px;">Do you want to replace all existing notebook cells or append the template to the bottom of the current cells?</p>
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
              <button id="nb-tpl-confirm-cancel" class="modal-cancel-btn" type="button">Cancel</button>
              <button id="nb-tpl-confirm-replace" class="modal-save-btn" style="background-color: var(--primary);" type="button">Replace</button>
              <button id="nb-tpl-confirm-continue" class="modal-save-btn" type="button">Continue</button>
            </div>
          </div>
        </div>

        <!-- Templates Modal -->
        <div id="nb-templates-modal" class="nb-tpl-overlay" style="display:none">
          <div class="nb-tpl-modal">
            <div class="nb-tpl-header">
              <div class="nb-tpl-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                Code Templates
              </div>
              <button id="nb-tpl-close" class="nb-tpl-close" type="button">&times;</button>
            </div>

            <!-- Tabs -->
            <div class="nb-tpl-tabs">
              <button class="nb-tpl-tab active" data-tpl-tab="builtin" type="button">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                Built-in
              </button>
              <button class="nb-tpl-tab" data-tpl-tab="community" type="button">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15 15 0 0 1 0 20 15 15 0 0 1 0-20z"/></svg>
                Community
              </button>
              <button class="nb-tpl-tab" data-tpl-tab="import" type="button">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                Import
              </button>
            </div>

            <!-- Built-in Tab -->
            <div id="nb-tpl-tab-builtin" class="nb-tpl-tab-content active">
              <div class="nb-tpl-search-row">
                <input type="text" id="nb-tpl-search" class="nb-tpl-search" placeholder="Search 3000+ templates...">
              </div>
              <div id="nb-tpl-categories" class="nb-tpl-categories"></div>
              <div id="nb-tpl-grid" class="nb-tpl-grid"></div>
            </div>

            <!-- Community Tab -->
            <div id="nb-tpl-tab-community" class="nb-tpl-tab-content">
              <div class="nb-tpl-community-search-row">
                <input type="text" id="nb-tpl-community-search" class="nb-tpl-search" placeholder="Search GitHub for notebooks and scripts...">
                <button id="nb-tpl-community-search-btn" class="nb-tpl-community-btn" type="button">Search GitHub</button>
              </div>
              <p class="nb-tpl-community-hint">Search millions of public Python scripts and notebooks. Rate limit: 10 req/min (unauthenticated).</p>
              <div id="nb-tpl-community-grid" class="nb-tpl-grid"></div>
            </div>

            <!-- Import Tab -->
            <div id="nb-tpl-tab-import" class="nb-tpl-tab-content">
              <div class="nb-tpl-import-section">
                <h4>Import from URL</h4>
                <p class="nb-tpl-community-hint">Paste a GitHub file URL, Gist URL, or any raw .py / .ipynb link.</p>
                <div class="nb-tpl-community-search-row">
                  <input type="text" id="nb-tpl-import-url" class="nb-tpl-search" placeholder="https://github.com/user/repo/blob/main/train.py">
                  <button id="nb-tpl-import-btn" class="nb-tpl-community-btn" type="button">Import</button>
                </div>
                <p id="nb-tpl-import-status" class="nb-tpl-community-hint"></p>
              </div>
              <div class="nb-tpl-import-section" style="margin-top:1.5rem">
                <h4>Paste Code</h4>
                <p class="nb-tpl-community-hint">Paste any Python code to add as a new cell.</p>
                <textarea id="nb-tpl-paste-code" class="nb-tpl-paste-area" rows="8" placeholder="# Paste your Python code here..."></textarea>
                <button id="nb-tpl-paste-btn" class="nb-tpl-community-btn" type="button" style="margin-top:0.5rem">Add as Cell</button>
              </div>
            </div>
          </div>
        </div>

        <!-- /NOTEBOOK VIEW -->

        <!-- DATASET CREATOR VIEW -->
        <div id="dataset-creator-view" class="view">
          <div class="dc-container">
            <!-- Header -->
            <div class="dc-header">
              <h1 class="dc-title">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
                Multi-Format Dataset Creator
              </h1>
              <p class="dc-subtitle">Clean, deduplicate, and format massive raw datasets directly in the cloud. This advanced computing feature requires a Pro subscription.</p>
            </div>

            <!-- Error Banner -->
            <div id="dataset-error-banner" class="dc-error-banner" style="display:none;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              <span id="dataset-error-text"></span>
            </div>

            <!-- Two-column grid -->
            <div class="dc-grid">
              <!-- Left Column: Upload Form -->
              <div class="dc-card">
                <h2 class="dc-card-title">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                  Upload Raw Data
                </h2>

                <div class="dc-form">
                  <!-- Format Selector -->
                  <div class="dc-field">
                    <label class="dc-label" for="dataset-format-select">Target Output Format</label>
                    <select id="dataset-format-select" class="dc-select">
                      <option value="jsonl">JSONL (Chat Completions)</option>
                      <option value="parquet">Parquet (Columnar)</option>
                      <option value="csv">CSV (Tabular)</option>
                    </select>
                  </div>

                  <!-- File Input -->
                  <div class="dc-field">
                    <label class="dc-label">Source File (&gt;1GB supported)</label>
                    <input type="file" id="dataset-file-input" class="dc-file-input" />
                  </div>

                  <!-- Upload Button -->
                  <button id="dataset-upload-btn" class="dc-upload-btn" type="button">
                    Secure Upload &amp; Process
                  </button>

                  <!-- Progress Bar -->
                  <div id="dataset-upload-progress-wrap" class="dc-progress-wrap" style="display:none;">
                    <div class="dc-progress-track">
                      <div id="dataset-upload-progress-bar" class="dc-progress-fill" style="width:0%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Processing Status -->
              <div class="dc-card dc-card-status">
                <h2 class="dc-card-title">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                  Processing Status
                </h2>

                <div id="dataset-job-status" class="dc-status-body">
                  <!-- Idle state -->
                  <div id="dataset-status-idle" class="dc-status-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-dim, #555)" stroke-width="1.5"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                    <p class="dc-status-text">No active tasks. Upload a dataset to begin processing.</p>
                  </div>

                  <!-- Pending/Processing state (hidden by default) -->
                  <div id="dataset-status-pending" class="dc-status-state" style="display:none;">
                    <svg class="dc-spinner" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--primary, #3b82f6)" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                    <div class="dc-status-info">
                      <p class="dc-status-label">Pipeline running in secure sandbox...</p>
                      <p id="dataset-job-meta" class="dc-status-meta"></p>
                    </div>
                  </div>

                  <!-- Completed state (hidden by default) -->
                  <div id="dataset-status-completed" class="dc-status-state" style="display:none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    <div class="dc-status-info">
                      <p class="dc-status-label">Job completed</p>
                      <a id="dataset-download-link" href="#" target="_blank" class="dc-download-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Download Result
                      </a>
                    </div>
                  </div>

                  <!-- Failed state (hidden by default) -->
                  <div id="dataset-status-failed" class="dc-status-state" style="display:none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                    <p class="dc-status-label">Job failed</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Premium Overlay -->
            <div id="dataset-premium-banner" class="dc-premium-banner">
              <div class="dc-premium-left">
                <div class="dc-premium-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
                </div>
                <div>
                  <h3 class="dc-premium-title">Pro Plan Required</h3>
                  <p class="dc-premium-desc">Dataset processing utilizes heavy isolated compute infrastructure. Upgrade your account to unlock.</p>
                </div>
              </div>
              <a href="#" class="dc-premium-cta">Upgrade to Pro</a>
            </div>
          </div>
        </div>
        <!-- /DATASET CREATOR VIEW -->

        <!-- DATA STUDIO VIEW -->
        <div id="data-studio-view" class="view">
          <div class="instances-container">
            <div class="instances-header">
              <h2 class="instances-title">Data Studio</h2>
              <p class="instances-subtitle">Edit, structure, and refine project datasets</p>
            </div>

            <div class="studio-layout">
              <aside class="studio-sidebar">
                <div class="studio-sidebar-header">
                  <h3>Datasets</h3>
                  <button id="studio-refresh-btn" class="ds-btn" type="button">Refresh</button>
                </div>
                <input id="studio-search-input" class="gpu-form-input" type="text" placeholder="Search rows..." />
                <div id="studio-dataset-list" class="studio-dataset-list"></div>
              </aside>

              <section class="studio-main">
                <div class="studio-toolbar">
                  <div class="studio-toolbar-title">
                    <h3 id="studio-active-name">No dataset selected</h3>
                    <p id="studio-active-meta">Pick a dataset to start editing</p>
                  </div>
                  <div class="studio-toolbar-actions">
                    <button id="studio-add-row-btn" class="ds-btn" type="button">Add Row</button>
                    <button id="studio-add-col-btn" class="ds-btn" type="button">Add Column</button>
                    <button id="studio-delete-dataset-btn" class="ds-btn" type="button">Delete Dataset</button>
                  </div>
                </div>

                <p id="studio-status" class="gpu-inline-status"></p>

                <div id="studio-empty" class="studio-empty-state">No datasets found in this project yet. Create one in Dataset Creator first.</div>

                <div id="studio-table-wrap" class="studio-table-wrap hidden">
                  <table class="studio-table" id="studio-table">
                    <thead id="studio-table-head"></thead>
                    <tbody id="studio-table-body"></tbody>
                  </table>
                </div>

                <div id="studio-pagination" class="studio-pagination hidden">
                  <button id="studio-prev-btn" class="ds-btn" type="button">Previous</button>
                  <span id="studio-page-label">Page 1 / 1</span>
                  <button id="studio-next-btn" class="ds-btn" type="button">Next</button>
                </div>
              </section>
            </div>
          </div>
        </div>
        <!-- /DATA STUDIO VIEW -->

        <!-- PROJECTS VIEW -->
        <div id="projects-view" class="view">
          <div class="instances-container">
            <div class="instances-header">
              <h2 class="instances-title">Projects</h2>
              <p class="instances-subtitle">Manage and organize all your AI projects</p>
            </div>
            <div class="provider-grid" id="projects-grid">
              <!-- Project cards will be injected by JS -->
            </div>
          </div>
        </div>
        <!-- /PROJECTS VIEW -->

        <!-- STORE VIEW -->
        <div id="store-view" class="view">
          <div class="instances-container">
            <div class="instances-header">
              <h2 class="instances-title">Store</h2>
              <p class="instances-subtitle">Discover AI resources â€” models, datasets, papers, code & tools</p>
            </div>

            <!-- Search Bar -->
            <div class="store-search-bar">
              <div class="store-search-input-wrap">
                <svg class="store-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <input id="store-search-input" class="store-search-input" type="text" placeholder="Search models, datasets, papers, tools..." />
              </div>
              <button id="store-search-btn" class="store-search-btn" type="button">Search</button>
            </div>

            <!-- Category Tabs -->
            <div class="store-tabs">
              <button class="store-tab active" data-store-type="all">All</button>
              <button class="store-tab" data-store-type="model">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                Models
              </button>
              <button class="store-tab" data-store-type="dataset">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="8" ry="3"/><path d="M4 5v10c0 1.66 3.58 3 8 3s8-1.34 8-3V5"/><path d="M4 10c0 1.66 3.58 3 8 3s8-1.34 8-3"/></svg>
                Datasets
              </button>
              <button class="store-tab" data-store-type="paper">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                Papers
              </button>
              <button class="store-tab" data-store-type="code">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                Code &amp; Tools
              </button>
            </div>

            <!-- Source Filters & Sort -->
            <div class="store-filters-row">
              <div class="store-source-chips">
                <span class="store-filter-label">Sources:</span>
                <button class="store-source-chip active" data-store-source="all">All</button>
                <button class="store-source-chip" data-store-source="huggingface">
                  <span class="store-source-emoji">ðŸ¤—</span> Hugging Face
                </button>
                <button class="store-source-chip" data-store-source="github">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
                  GitHub
                </button>
                <button class="store-source-chip" data-store-source="arxiv">
                  <span class="store-source-emoji">ðŸ“„</span> arXiv
                </button>
                <button class="store-source-chip" data-store-source="semanticscholar">
                  <span class="store-source-emoji">ðŸŽ“</span> Semantic Scholar
                </button>
                <button class="store-source-chip" data-store-source="civitai">
                  <span class="store-source-emoji">ðŸŽ¨</span> Civitai
                </button>
                <button class="store-source-chip" data-store-source="kaggle">
                  <img src="/logos/kaggle.svg" alt="Kaggle" width="13" height="13" style="vertical-align: -1px;" />
                  Kaggle
                </button>
                <button class="store-source-chip" data-store-source="paperswithcode">
                  <span class="store-source-emoji">ðŸ“</span> Papers With Code
                </button>
                <button class="store-source-chip" data-store-source="zenodo">
                  <span class="store-source-emoji">ðŸ”¬</span> Zenodo
                </button>
                <button class="store-source-chip" data-store-source="dblp">
                  <span class="store-source-emoji">ðŸ“š</span> DBLP
                </button>
                <button class="store-source-chip" data-store-source="ollama">
                  <span class="store-source-emoji">ðŸ¦™</span> Ollama
                </button>
                <button class="store-source-chip" data-store-source="replicate">
                  <span class="store-source-emoji">ðŸ”„</span> Replicate
                </button>
              </div>
              <div class="store-sort-wrap">
                <label class="store-sort-label" for="store-sort-select">Sort:</label>
                <select id="store-sort-select" class="store-sort-select">
                  <option value="trending">Trending</option>
                  <option value="downloads">Most downloads</option>
                  <option value="stars">Most stars</option>
                  <option value="citations">Most cited</option>
                  <option value="recent">Most recent</option>
                  <option value="relevance">Relevance</option>
                </select>
              </div>
            </div>

            <!-- Results Summary -->
            <div class="store-results-summary" id="store-results-summary" style="display:none;">
              <span id="store-results-count"></span>
              <span id="store-results-query"></span>
            </div>

            <!-- Loading State -->
            <div class="store-loading" id="store-loading" style="display:none;">
              <div class="store-loading-spinner"></div>
              <span>Searching resources...</span>
            </div>

            <!-- Empty State (fallback only) -->
            <div class="store-empty" id="store-empty" style="display:none;">
              <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--text-dim)" stroke-width="1.2">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <h3>Explore AI Resources</h3>
              <p>Search for models, datasets, research papers, and developer tools across Hugging Face, GitHub, arXiv, Kaggle, and more.</p>
              <div class="store-quick-searches">
                <button class="store-quick-chip" data-query="transformer language model">Transformers</button>
                <button class="store-quick-chip" data-query="text generation">Text Generation</button>
                <button class="store-quick-chip" data-query="image classification dataset">Image Classification</button>
                <button class="store-quick-chip" data-query="reinforcement learning">RL</button>
                <button class="store-quick-chip" data-query="diffusion model">Diffusion</button>
                <button class="store-quick-chip" data-query="RAG retrieval augmented generation">RAG</button>
                <button class="store-quick-chip" data-query="fine-tuning LORA">LoRA Fine-tuning</button>
                <button class="store-quick-chip" data-query="speech recognition whisper">Speech</button>
              </div>
            </div>

            <!-- Featured Storefront (auto-loaded, Amazon/Flipkart style) -->
            <div class="store-featured" id="store-featured" style="display:none;"></div>

            <!-- Resource Cards Grid -->
            <div class="store-grid" id="store-grid"></div>

            <!-- Pagination -->
            <div class="store-pagination" id="store-pagination" style="display:none;">
              <button id="store-prev-btn" class="store-page-btn" type="button" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                Previous
              </button>
              <span id="store-page-label" class="store-page-label">Page 1</span>
              <button id="store-next-btn" class="store-page-btn" type="button">
                Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
              </button>
            </div>

            <!-- Project Resources (Added items) -->
            <div class="store-project-resources" id="store-project-resources" style="display:none;">
              <div class="store-section-header">
                <h3>Added to Project</h3>
                <span id="store-project-count" class="store-badge">0</span>
              </div>
              <div id="store-project-list" class="store-project-list"></div>
            </div>
          </div>
        </div>

        <!-- Store Detail Modal -->
        <div class="modal-overlay store-detail-modal" id="store-detail-modal" style="display:none;">
          <div class="modal-content store-detail-content">
            <div class="modal-header">
              <div class="store-detail-header-info">
                <span id="store-detail-source-badge" class="store-source-badge"></span>
                <h3 id="store-detail-title"></h3>
              </div>
              <button class="modal-close" id="store-detail-close">&times;</button>
            </div>
            <div class="modal-body store-detail-body">
              <p id="store-detail-author" class="store-detail-author"></p>
              <p id="store-detail-description" class="store-detail-description"></p>
              <div id="store-detail-metrics" class="store-detail-metrics"></div>
              <div id="store-detail-tags" class="store-detail-tags"></div>
              <div class="store-detail-meta">
                <p id="store-detail-license" class="store-detail-meta-item"></p>
                <p id="store-detail-updated" class="store-detail-meta-item"></p>
              </div>
            </div>
            <div class="modal-footer">
              <a id="store-detail-link" class="store-detail-link-btn" href="#" target="_blank" rel="noopener">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                Open on source
              </a>
              <button id="store-detail-share-btn" class="store-detail-link-btn" style="background: none; border: 1px solid var(--border-color, #333); cursor: pointer; color: inherit; font-size: inherit; font-family: inherit; display: inline-flex; align-items: center; gap: 6px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                Share
              </button>
              <button id="store-detail-add-btn" class="modal-save-btn store-detail-add-btn">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add to project
              </button>
            </div>
          </div>
        </div>
        <!-- /STORE VIEW -->

        <!-- SETTINGS VIEW -->
        <div id="settings-view" class="view">
          <div class="instances-container">
            <div class="instances-header">
              <h2 class="instances-title">Settings</h2>
              <p class="instances-subtitle">Configure your account and workspace preferences</p>
            </div>

            <div class="menu-hero-card settings-hero">
              <div class="menu-hero-shapes" aria-hidden="true">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <path d="M 120 0 Q 80 100 200 120 L 200 0 Z" fill="#2eb0f1" />
                  <path d="M 200 100 Q 150 150 200 200 Z" fill="#24b662" />
                  <path d="M 100 200 Q 150 100 200 150 L 200 200 Z" fill="#fcca22" />
                </svg>
              </div>
              <div class="menu-hero-content">
                <p class="menu-hero-eyebrow">Workspace Preferences</p>
                <h3>Control Center</h3>
                <p>Fine-tune your agent, tools, account, and diagnostics from a unified menu.</p>
              </div>
            </div>
            
            <div class="settings-layout">
              <!-- Sidebar Navigation -->
              <div class="settings-sidebar">
                <button class="settings-nav-btn active" data-settings-tab="agent">Text2LLM Agent</button>
                <button class="settings-nav-btn" data-settings-tab="appearance">Appearance</button>
                <button class="settings-nav-btn" data-settings-tab="account">Account</button>
                <button class="settings-nav-btn" data-settings-tab="tools">Tools & Execution</button>
                <button class="settings-nav-btn" data-settings-tab="skills">Skills & Extensions</button>
                <button class="settings-nav-btn" data-settings-tab="diagnostics">Diagnostics</button>
                <button class="settings-nav-btn" data-settings-tab="web-proxy">Web Proxy</button>
              </div>

              <!-- Content Area -->
              <div class="settings-content-area">
                
                <!-- Text2LLM Agent Tab -->
                <div class="settings-panel active" id="settings-panel-agent">
                  <h3 class="settings-panel-title">Text2LLM Agent</h3>
                  <div class="gpu-launch-form">
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Primary Model</span>
                        <input id="setting-agent-model" class="gpu-form-input" type="text" placeholder="e.g. google-gemini-cli/gemini-3-pro-preview" />
                      </label>
                      <label class="gpu-form-label">
                        <span>Agent Workspace Directory</span>
                        <input id="setting-agent-workspace" class="gpu-form-input" type="text" placeholder="e.g. c:/Users/.../workspace" />
                      </label>
                    </div>
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Tool Profile</span>
                        <select id="setting-tools-profile" class="gpu-form-select">
                          <option value="coding">Coding</option>
                          <option value="default">Default</option>
                          <option value="minimal">Minimal</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Native Commands</span>
                        <select id="setting-commands-native" class="gpu-form-select">
                          <option value="auto">Auto</option>
                          <option value="on">On</option>
                          <option value="off">Off</option>
                        </select>
                      </label>
                    </div>
                    <label class="gpu-form-label">
                      <span>Native Skills Commands</span>
                      <select id="setting-commands-native-skills" class="gpu-form-select">
                        <option value="auto">Auto</option>
                        <option value="on">On</option>
                        <option value="off">Off</option>
                      </select>
                    </label>

                    <h4 style="margin-top: 24px; font-size: 0.9rem; color: var(--text);">Skills Pipeline</h4>
                    <p style="font-size: 0.82rem; color: var(--text-dim); margin-bottom: 12px;">Enable or disable individual pipeline skills for the Text2LLM agent.</p>
                    <div class="settings-skills-grid">
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-data-pipeline" checked /><span>Data Pipeline</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-tokenizer-trainer" checked /><span>Tokenizer Trainer</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-model-architect" checked /><span>Model Architect</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-gpu-provisioner" checked /><span>GPU Provisioner</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-training-runner" checked /><span>Training Runner</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-wandb-tracker" checked /><span>W&amp;B Tracker</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-eval-bench" checked /><span>Eval Bench</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-model-publisher" checked /><span>Model Publisher</span></label>
                      <label class="settings-skill-toggle"><input type="checkbox" id="skill-cloud-storage" checked /><span>Cloud Storage</span></label>
                    </div>
                  </div>
                </div>

                <!-- Appearance Tab -->
                <div class="settings-panel" id="settings-panel-appearance">
                  <h3 class="settings-panel-title">Appearance</h3>
                  <p style="font-size:0.82rem;color:var(--text-dim);margin-bottom:16px;">Stored in your browser — applies to this device only.</p>
                  <div class="gpu-launch-form">
                    <label class="gpu-form-label">
                      <span>UI Accent Color</span>
                      <input id="setting-ui-seam" class="gpu-form-input" type="color" value="#00e5bf" style="height: 40px; padding: 4px;" />
                    </label>
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Assistant Name</span>
                        <input id="setting-assistant-name" class="gpu-form-input" type="text" placeholder="e.g. Text2LLM" />
                      </label>
                      <label class="gpu-form-label">
                        <span>Assistant Avatar URL</span>
                        <input id="setting-assistant-avatar" class="gpu-form-input" type="url" placeholder="https://..." />
                      </label>
                    </div>

                  </div>
                </div>

                <!-- Tools & Execution Tab -->
                <div class="settings-panel" id="settings-panel-tools">
                  <h3 class="settings-panel-title">Tools & Execution</h3>
                  <div class="gpu-launch-form">
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Shell Execution</span>
                        <select id="setting-shell-enabled" class="gpu-form-select">
                          <option value="true">Enabled</option>
                          <option value="false">Disabled</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Shell Timeout (ms)</span>
                        <input id="setting-shell-timeout" class="gpu-form-input" type="number" min="1000" placeholder="e.g. 120000" />
                      </label>
                    </div>
                    <label class="gpu-form-label">
                      <span>Tool Allowlist (comma separated)</span>
                      <input id="setting-tools-allow" class="gpu-form-input" type="text" placeholder="* (All tools allowed)" />
                    </label>
                    <label class="gpu-form-label">
                      <span>Tool Denylist (comma separated)</span>
                      <input id="setting-tools-deny" class="gpu-form-input" type="text" placeholder="e.g. file_delete, format_drive" />
                    </label>
                    <h4 style="margin-top: 24px; font-size: 0.9rem; color: var(--text);">Browser Automation</h4>
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Agent Browser</span>
                        <select id="setting-browser-enabled" class="gpu-form-select">
                          <option value="true">Enabled</option>
                          <option value="false">Disabled</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Headless Mode</span>
                        <select id="setting-browser-headless" class="gpu-form-select">
                          <option value="true">Enabled (Hidden)</option>
                          <option value="false">Disabled (Visible)</option>
                        </select>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Skills & Extensions Tab -->
                <div class="settings-panel" id="settings-panel-skills">
                  <h3 class="settings-panel-title">Skills & Extensions</h3>
                  <div class="gpu-launch-form">
                    <label class="gpu-form-label">
                      <span>Extra Skill Directories (comma separated paths)</span>
                      <input id="setting-skills-dirs" class="gpu-form-input" type="text" placeholder="/path/to/custom/skills" />
                    </label>
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Live Reloading</span>
                        <select id="setting-skills-watch" class="gpu-form-select">
                          <option value="true">Enabled</option>
                          <option value="false">Disabled</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Node Package Manager</span>
                        <select id="setting-skills-npm" class="gpu-form-select">
                          <option value="npm">npm</option>
                          <option value="pnpm">pnpm</option>
                          <option value="yarn">yarn</option>
                          <option value="bun">bun</option>
                        </select>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Diagnostics Tab -->
                <div class="settings-panel" id="settings-panel-diagnostics">
                  <h3 class="settings-panel-title">Diagnostics</h3>
                  <div class="gpu-launch-form">
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Log Level</span>
                        <select id="setting-log-level" class="gpu-form-select">
                          <option value="info">Info</option>
                          <option value="debug">Debug</option>
                          <option value="trace">Trace</option>
                          <option value="warn">Warn</option>
                          <option value="error">Error</option>
                          <option value="silent">Silent</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Console Style</span>
                        <select id="setting-log-style" class="gpu-form-select">
                          <option value="pretty">Pretty</option>
                          <option value="compact">Compact</option>
                          <option value="json">JSON</option>
                        </select>
                      </label>
                    </div>
                    <label class="gpu-form-label">
                      <span>Redact Sensitive Info</span>
                      <select id="setting-log-redact" class="gpu-form-select">
                        <option value="tools">Redact from tools</option>
                        <option value="off">Off (Not recommended)</option>
                      </select>
                    </label>
                    <h4 style="margin-top: 24px; font-size: 0.9rem; color: var(--text);">Telemetry (OTEL)</h4>
                    <label class="gpu-form-label">
                      <span>OpenTelemetry Provider</span>
                      <select id="setting-otel-enabled" class="gpu-form-select">
                        <option value="true">Enabled</option>
                        <option value="false">Disabled</option>
                      </select>
                    </label>
                  </div>
                </div>

                <!-- Account Tab -->
                <div class="settings-panel" id="settings-panel-account">
                  <h3 class="settings-panel-title">Account</h3>
                  <p style="font-size:0.82rem;color:var(--text-dim);margin-bottom:16px;">Synced to the cloud via Supabase — available on all devices.</p>
                  <div class="gpu-launch-form">
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>Display Name</span>
                        <input id="setting-account-display-name" class="gpu-form-input" type="text" placeholder="Your name" />
                      </label>
                      <label class="gpu-form-label">
                        <span>Email (read-only)</span>
                        <input id="setting-account-email" class="gpu-form-input" type="email" placeholder="—" disabled style="opacity:0.6;cursor:not-allowed;" />
                      </label>
                    </div>
                    <h4 style="margin-top:24px;font-size:0.9rem;color:var(--text);">Usage This Month</h4>
                    <div class="settings-usage-grid">
                      <div class="settings-usage-card">
                        <span class="settings-usage-label">Requests</span>
                        <span class="settings-usage-value" id="account-stat-requests">—</span>
                      </div>
                      <div class="settings-usage-card">
                        <span class="settings-usage-label">Input Tokens</span>
                        <span class="settings-usage-value" id="account-stat-input">—</span>
                      </div>
                      <div class="settings-usage-card">
                        <span class="settings-usage-label">Output Tokens</span>
                        <span class="settings-usage-value" id="account-stat-output">—</span>
                      </div>
                      <div class="settings-usage-card">
                        <span class="settings-usage-label">Errors</span>
                        <span class="settings-usage-value" id="account-stat-errors">—</span>
                      </div>
                    </div>
                    <p id="account-load-status" style="font-size:0.8rem;color:var(--text-dim);margin-top:8px;"></p>
                  </div>
                </div>

                <!-- Web Proxy Tab -->
                <div class="settings-panel" id="settings-panel-web-proxy">
                  <h3 class="settings-panel-title">Web Proxy</h3>
                  <p style="font-size:0.82rem;color:var(--text-dim);margin-bottom:16px;">Stored in your browser — connects the frontend to the deployed proxy backend.</p>
                  <div class="gpu-launch-form">
                    <label class="gpu-form-label">
                      <span>Proxy URL</span>
                      <input id="setting-proxy-url" class="gpu-form-input" type="url" placeholder="https://your-proxy.fly.dev" />
                    </label>
                    <div class="gpu-form-row">
                      <label class="gpu-form-label">
                        <span>LLM Provider</span>
                        <select id="setting-proxy-provider" class="gpu-form-select">
                          <option value="openai">OpenAI</option>
                          <option value="openrouter">OpenRouter</option>
                          <option value="anthropic">Anthropic</option>
                          <option value="google">Google</option>
                        </select>
                      </label>
                      <label class="gpu-form-label">
                        <span>Provider API Key</span>
                        <input id="setting-proxy-api-key" class="gpu-form-input" type="password" placeholder="sk-..." autocomplete="off" />
                      </label>
                    </div>
                    <label class="gpu-form-label">
                      <span>Supabase Access Token</span>
                      <input id="setting-proxy-supabase-token" class="gpu-form-input" type="password" placeholder="eyJ..." autocomplete="off" />
                    </label>
                    <label class="gpu-form-label">
                      <span>Web Proxy Model</span>
                      <input id="setting-proxy-model" class="gpu-form-input" type="text" placeholder="e.g. gpt-4.1-mini" />
                    </label>
                    <div style="margin-top:16px;display:flex;align-items:center;gap:12px;">
                      <button id="settings-proxy-test-btn" class="ds-btn" type="button" style="min-width:140px;">Test Connection</button>
                      <span id="proxy-test-status" style="font-size:0.82rem;"></span>
                    </div>
                  </div>
                </div>

                <!-- Save Button Container -->
                <div class="settings-actions">
                    <button id="settings-save-btn" class="ds-btn ds-btn-primary" type="button">Save Preferences</button>
                    <span id="settings-save-status" class="gpu-inline-status"></span>
                </div>

              </div>
            </div>
          </div>
        </div>
        <!-- /SETTINGS VIEW -->

      </main>

        <!-- Profile Modal (Kaggle-style) -->
        <div id="profile-modal" class="nb-tpl-overlay" style="display:none; z-index: 2000;">
          <div class="profile-modal-container">
            
            <!-- Top Hero Banner with Graphic Shapes -->
            <div class="profile-hero">
              <button class="profile-settings-btn" id="profile-settings-btn">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                Settings
              </button>
              
              <div class="profile-hero-shapes">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <path d="M 120 0 Q 80 100 200 120 L 200 0 Z" fill="#2eb0f1" />
                  <path d="M 200 100 Q 150 150 200 200 Z" fill="#24b662" />
                  <path d="M 100 200 Q 150 100 200 150 L 200 200 Z" fill="#fcca22" />
                </svg>
              </div>

              <div class="profile-hero-content">
                <div class="profile-avatar-wrapper">
                  <div class="profile-avatar-large" id="profile-modal-avatar">
                    <!-- Avatar injected via JS -->
                     <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-dim)" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                  </div>
                </div>
                
                <div class="profile-user-details">
                  <div class="profile-username" id="profile-modal-username">username</div>
                  <div class="profile-displayname" id="profile-modal-name">Display Name</div>
                  <div class="profile-meta" id="profile-modal-meta">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    Joined recently
                  </div>
                </div>
                
                <!-- Close button for modal -->
                <button class="profile-close-btn" id="profile-modal-close">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
              </div>
            </div>

            <div class="profile-body">
              <div class="profile-tabs">
                <button class="profile-tab active" data-ptab="about">About</button>
                <button class="profile-tab" data-ptab="activity">Activity</button>
              </div>
              
              <div class="profile-tab-content active" id="ptab-about">
                <h3 class="profile-section-title">Bio</h3>
                <p class="profile-bio" id="profile-modal-bio">No bio yet...</p>
                
                <!-- Guest Warning Banner -->
                <div id="profile-guest-warning" class="profile-guest-warning" style="display:none;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                  <div>
                    <strong>Guest Session Active</strong>
                    <p>You are logged in as a guest. Your data, projects, and custom settings will be lost when you sign out or close the browser.</p>
                  </div>
                </div>
                
                <div class="profile-actions-bottom">
                  <button id="profile-signout-btn" class="ds-btn ds-btn-primary" style="margin-top: 24px; background-color: var(--surface-hover); color: var(--text); border: 1px solid var(--border-color);">
                    Sign Out
                  </button>
                </div>
              </div>

              <div class="profile-tab-content" id="ptab-activity">
                 <div class="profile-empty-state">
                   No recent activity.
                 </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Auth Modal -->
        <div class="modal-overlay auth-modal" id="auth-modal" style="display:none; z-index: 9999;">
          <div class="modal-content auth-modal-content" style="max-width: 400px; width: 100%; border-radius: 12px; border: 1px solid var(--border-color); background: var(--surface);">
            <div class="modal-header">
              <h3 style="margin: 0; font-size: 1.2rem; font-weight: 600;">Sign In / Sign Up</h3>
              <button class="modal-close" id="auth-modal-close" style="background: none; border: none; font-size: 1.5rem; color: var(--text-dim); cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; gap: 16px; padding: 24px;">
              <input id="auth-email" class="gpu-form-input" type="email" placeholder="Email Address" style="width: 100%; box-sizing: border-box;" />
              <input id="auth-password" class="gpu-form-input" type="password" placeholder="Password" style="width: 100%; box-sizing: border-box;" />
              <div id="turnstile-widget" style="margin: 0 auto;"></div>
              <button id="auth-signin-btn" class="ds-btn ds-btn-primary" style="width: 100%; justify-content: center; padding: 10px;">Sign In</button>
              <button id="auth-signup-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px;">Sign Up</button>
              
              <div style="display: flex; align-items: center; margin: 8px 0;">
                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                <span style="padding: 0 10px; color: var(--text-dim); font-size: 0.85rem;">OR</span>
                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
              </div>
              
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <button id="auth-google-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px; background: #ffffff; color: #3c4043; border: 1px solid #dadce0; font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 14px; transition: background 0.2s;">
                  <img src="/logos/google.svg" alt="Google" width="18" height="18" style="margin-right: 12px;" onerror="this.style.display='none'"> Continue with Google
                </button>
                <button id="auth-discord-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px; background: #5865F2; color: #ffffff; border: none; font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 14px; transition: opacity 0.2s;">
                  <img src="/logos/discord.svg" alt="Discord" width="18" height="18" style="margin-right: 12px;" onerror="this.style.display='none'"> Continue with Discord
                </button>
                <button id="auth-github-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px; background: #24292e; color: #ffffff; border: none; font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 14px; transition: opacity 0.2s;">
                  <img src="/logos/github.svg" alt="GitHub" width="18" height="18" style="margin-right: 12px;" onerror="this.style.display='none'"> Continue with GitHub
                </button>
                <button id="auth-facebook-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px; background: #1877F2; color: #ffffff; border: none; font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 14px; transition: opacity 0.2s;">
                  <img src="/logos/facebook.svg" alt="Facebook" width="18" height="18" style="margin-right: 12px;" onerror="this.style.display='none'"> Continue with Facebook
                </button>
                <button id="auth-guest-btn" class="ds-btn" style="width: 100%; justify-content: center; padding: 10px; background: var(--surface-hover); color: var(--text); border: 1px solid var(--border-color); font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 14px; transition: background 0.2s;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 12px;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Continue as Guest
                </button>
              </div>
              <p id="auth-error-msg" class="gpu-inline-status" style="color: var(--danger, #ff4d4f); text-align: center; margin: 0; min-height: 20px;"></p>
              <p id="auth-success-msg" class="gpu-inline-status" style="color: var(--success, #00e5bf); text-align: center; margin: 0; min-height: 20px;"></p>
            </div>
          </div>
        </div>

    <nav class="mobile-tools-dock" id="mobile-tools-dock" aria-label="Quick tools">
      <button type="button" class="mobile-tool-btn" data-view="clui" title="Runtime">
        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
        <span>Runtime</span>
      </button>
      <button type="button" class="mobile-tool-btn" data-view="data-studio" title="Data Studio">
        <svg viewBox="0 0 24 24" aria-hidden="true"><ellipse cx="12" cy="5" rx="8" ry="3"></ellipse><path d="M4 5v10c0 1.66 3.58 3 8 3s8-1.34 8-3V5"></path><path d="M4 10c0 1.66 3.58 3 8 3s8-1.34 8-3"></path></svg>
        <span>Studio</span>
      </button>
      <button type="button" class="mobile-tool-btn mobile-tool-home-btn" data-view="home" title="Mission Control">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        <span>Home</span>
      </button>
      <button type="button" class="mobile-tool-btn" data-view="instances" title="Infrastructure">
        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg>
        <span>Infra</span>
      </button>
      <button type="button" class="mobile-tool-btn mobile-tool-more-btn" id="mobile-tools-more-btn" title="More tools">
        <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="1.5"></circle><circle cx="19" cy="12" r="1.5"></circle><circle cx="5" cy="12" r="1.5"></circle></svg>
        <span>More</span>
      </button>
    </nav>

    <button
      type="button"
      class="mobile-tools-backdrop"
      id="mobile-tools-backdrop"
      aria-label="Close tools"
      hidden
    ></button>

    <div class="mobile-tools-sheet" id="mobile-tools-sheet" role="dialog" aria-label="More tools" aria-hidden="true">
      <div class="mobile-tools-sheet-grab" aria-hidden="true"></div>
      <div class="mobile-tools-sheet-header">
        <div class="mobile-tools-sheet-title">More Tools</div>
        <div class="mobile-tools-sheet-subtitle">Open the rest of your workspace tools</div>
      </div>
      <button type="button" class="mobile-tools-sheet-item" data-view="notebook">
        <span class="mobile-tools-sheet-icon">ðŸ““</span>
        <span class="mobile-tools-sheet-content">
          <span class="mobile-tools-sheet-label">Experiments</span>
          <span class="mobile-tools-sheet-hint">Notebook and execution</span>
        </span>
        <span class="mobile-tools-sheet-chevron">â€º</span>
      </button>
      <button type="button" class="mobile-tools-sheet-item" data-view="dataset-creator">
        <span class="mobile-tools-sheet-icon">🗃️</span>
        <span class="mobile-tools-sheet-content">
          <span class="mobile-tools-sheet-label">Dataset Creator</span>
          <span class="mobile-tools-sheet-hint">Create datasets with AI pipelines</span>
        </span>
        <span class="mobile-tools-sheet-chevron">â€º</span>
      </button>
      <button type="button" class="mobile-tools-sheet-item" data-view="projects">
        <span class="mobile-tools-sheet-icon">ðŸ“</span>
        <span class="mobile-tools-sheet-content">
          <span class="mobile-tools-sheet-label">Project Vault</span>
          <span class="mobile-tools-sheet-hint">Manage projects</span>
        </span>
        <span class="mobile-tools-sheet-chevron">â€º</span>
      </button>
      <button type="button" class="mobile-tools-sheet-item" data-view="store">
        <span class="mobile-tools-sheet-icon">ðŸ§ </span>
        <span class="mobile-tools-sheet-content">
          <span class="mobile-tools-sheet-label">Model Library</span>
          <span class="mobile-tools-sheet-hint">Browse models and resources</span>
        </span>
        <span class="mobile-tools-sheet-chevron">â€º</span>
      </button>
      <button type="button" class="mobile-tools-sheet-item" data-view="settings">
        <span class="mobile-tools-sheet-icon">âš™ï¸</span>
        <span class="mobile-tools-sheet-content">
          <span class="mobile-tools-sheet-label">Settings</span>
          <span class="mobile-tools-sheet-hint">Workspace preferences</span>
        </span>
        <span class="mobile-tools-sheet-chevron">â€º</span>
      </button>
    </div>

    <footer class="status-bar" id="status-bar" aria-label="Workspace status bar">
      <div class="status-left">
        <button type="button" class="status-item status-button" id="status-notification-btn" title="Notifications">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          </svg>
          <span id="status-notification-count">0</span>
        </button>
        <button type="button" class="status-item status-button" id="status-runtime-item" title="Open Runtime view">
          <span id="status-runtime">Runtime: Offline</span>
        </button>
        <div class="status-item">
          <span id="status-active-view"></span>
        </div>
        <div class="status-item">
          <span id="status-stream">Agent: Ready</span>
        </div>
        <div class="status-item"><span id="status-project">No project</span></div>
      </div>
      <div class="status-right">
        <div class="status-item"><span id="status-stage">Stage: Define</span></div>
        <div class="status-item"><span id="status-thread-count">0 runs</span></div>
        <div class="status-item"><span id="status-model">Model: Auto</span></div>
        <button type="button" class="status-item status-button" id="status-primary-action-btn" title="Run prompt">
          <span id="status-primary-action-label">Run</span>
        </button>
      </div>
    </footer>
    </footer>


    <!-- xterm.js Scripts from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <!-- Markdown renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Retaining original script import -->
    <script src="/templates.js"></script>
    <script src="/app.js?v=2" type="module"></script>
  </body>
</html>
